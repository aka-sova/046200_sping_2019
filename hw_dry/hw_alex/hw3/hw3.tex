\documentclass[a4paper]{iacas}

\usepackage{cite}
\usepackage{hyperref}% embedding hyperlinks [must be loaded after dropping]
\usepackage{amsmath,amsthm,amssymb,amsfonts,latexsym,mathrsfs,wasysym}
\usepackage{marvosym}
\usepackage{subcaption}
\usepackage{soul,color}
\usepackage{threeparttable}% tables with footnotes
\usepackage{dcolumn}% decimal-aligned tabular math columns
\usepackage{float}
\usepackage{graphicx}
%\usepackage{accents}
\usepackage{tikz}
\usepackage{lastpage}
\usepackage{fancyhdr}
\usepackage{color}
\usepackage{cancel}
\usepackage{setspace}
\usepackage{physics}
\usepackage{enumitem}
\usepackage{mathtools}
\usepackage{amsmath}
\usepackage{pdfpages}

	% use for derivatives:
%	\dv{Q}{t} = \dv{s}{t}  \quad
%	\dv[n]{Q}{t} = \dv[n]{s}{t}  \quad
%	\pdv{Q}{t} = \pdv{s}{t}  \quad
%	\pdv[n]{Q}{t} = \pdv[n]{s}{t}  \quad
%	\pdv{Q}{x}{t} = \pdv{s}{x}{t}  \quad

%\doublespacing
% or:
\onehalfspacing
%\usepackage[T1]{fontenc}
%\usepackage{bigfoot} % to allow verbatim in footnote
\usepackage[framed,numbered]{matlab-prettifier}
\pagestyle{plain}
%\usepackage[hebrew,english]{babel}
\usetikzlibrary{shapes.geometric, arrows, calc}

\newcolumntype{d}{D{.}{.}{-1}}
\graphicspath{{figures/}}

% define some commands to maintain consistency
\newcommand{\pkg}[1]{\texttt{#1}}
\newcommand{\cls}[1]{\textsf{#1}}
\newcommand{\file}[1]{\texttt{#1}}
\newcommand{\sgn}[1]{\operatorname{sgn}\left(#1\right)}
\newcommand{\sat}[1]{\operatorname{sat}\left(#1\right)}
\newcommand{\rrule}[1]{\rule[#1]{0pt}{0pt}}
\newcommand{\fracds}[2]{\frac{\displaystyle #1\rrule{-0.2em}}{\displaystyle #2\rrule{1em}}}
\newcommand{\figref}[1]{Fig.~\ref{#1}}
\newcommand{\ubar}[1]{\underaccent{\bar}{#1}}
%	\newcommand{\norm}[1]{\lvert \lvert \vec #1 \rvert \rvert}


%diffeomorphism

% XeLaTeX!
% ============================================================ %
% HEBREW support via polyglossia %
% ============================================================ %
	\usepackage{polyglossia}
	\defaultfontfeatures{Mapping=tex-text, Scale=MatchLowercase}
	\setdefaultlanguage{english}
	\setotherlanguage{hebrew}
	\newfontfamily\hebrewfont[Script=Hebrew]{Times New Roman}
% Use \begin{hebrew} block of text \end{hebrew} for paragraphs.
% Use \texthebrew{ } and \textenglish{ } for short texts.
% ============================================================ %



\begin{document}

\begin{center}
 \large Image processing - 046200
 \end{center}
\begin{center}
\large\textbf{Homework \#3}
 \end{center}


\begin{tabular}{l}
\\
{\bf\textit{Alexander Shender 328626114}} \\
{\bf\textit{Sahar Carmel 305554453}} \\
Technion - Israel Institute of Technology
\end{tabular}

\vspace{2em}

\newpage


\begin{hebrew}
\textit{\huge שאלה 1.}

א. ניתן לראות שהפעולה שאנו מבצעים הינה פעולת קונבולוציה עם דלתא של הזזה שמוגדרת כ: 
\end{hebrew}
$\delta(m-m_i,n-n_i)$
\begin{hebrew}
ולכן אנו נוכל לרשום את התמונה של $X[m,n]$ כסכום של קונבולוציות:
\end{hebrew}
$$X[m,n]  =\sum^P_{x=1}\phi[m,n]*\delta(m-m_i,n-n_i) \Longrightarrow h[m,n] = \delta(m-m_i,n-n_i)$$

\begin{hebrew}

ב. הזזה הינה אכן פעולה ספרבילית, כי ניתן לפרק את התזוזה לציר $X$ וגם לציר $Y$. נרחיב את הביטוי שמצאנו, לפירוק לשני הצירים:
\end{hebrew}
$$X[m,n]  =\sum^P_{x=1}\phi[m,n]*\delta(m-m_i,n-n_i) = \sum^P_{x=1}\phi[m,n]*(\delta(m-m_i)\delta(n-n_i))$$
\begin{hebrew}
ג. בדרך כלל, כנגד ה-$salt \& pepper$ השיטה המועילה להתגבר עליה הינה המסנן החציון. אך במקרה שלנו זאת לא השיטה שתניב תוצאה סבירה:
\\בהנחה שהתמונות $\psi[m,n]$ מפוזרות מספיק רחב בתמונה אנו נקבל שמסנן חציון יאפס לנו את כל התמונה (אלא אם כן יצא מקרה דופק בו נקבל 5 פיקסלים עם ערך 1 בריבוע של 9 פיקסלים, מה שאינו סביר, כי רק $3\%$ מהפיקסלים הם מרועשים).
\\בהנחה שהתמונות $\psi[m,n]$ מפורזרות מאד צפוף, נקבל שפיקסלים שבמקור היו לבנים, יקבלו עכשיו ערכים. וזה לא רצוי.
\end{hebrew}
\newline
\begin{hebrew}
השיטה המועילה לדעתינו תהיה השיטה של $\textrm{template matching}$. כתבנית אנו נשתמש בתמונה $\psi[m,n]$ , ובמקום בו אנו נקבל התאמה מעל סף מסוים שנקבע, נכניס את התמונה  $\psi[m,n]$ בתמונה החדשה שנגדיר. ככה נקרב את התנונה $\hat{U}[m,n]$ לתמונה המקורית האמיתית $U[m,n]$ 
\end{hebrew}


\newpage
\begin{hebrew}
\textit{\huge שאלה 2.}

א. נמצא את הסינון הלינארי. נתבונן רק בפילטר של השחזור, ונמצא פילטר בודד:
\end{hebrew}
\begin{equation*}
\alpha(1+k\nabla^2) = \alpha\left(\begin{bmatrix}0&0&0\\0&1&0\\0&0&0\end{bmatrix}+K\begin{bmatrix}0&1&0\\1&-4&1\\0&1&0\end{bmatrix}\right) = \begin{bmatrix}0&K&0\\K&\alpha-4K&K\\0&K&0\end{bmatrix}
\end{equation*}
\begin{hebrew}
כעת, על מנת לקבל סינון לינארי שעוברת התמונה, נשתמש גם במודל טשטוש שהוצע. נבצע קונבולוציה:
\end{hebrew}
\begin{equation*}
\psi = \frac{1}{8}\cdot \begin{bmatrix}0&K&0\\K&\alpha-4K&K\\0&K&0\end{bmatrix} * \begin{bmatrix}0&1&0\\1&4&1\\0&1&0\end{bmatrix}  = \frac{1}{8} \cdot \begin{bmatrix}0&0&K&0&0\\0&2K&\alpha&2K&0\\K&\alpha&4\alpha-12K&\alpha&K\\0&2K&\alpha&2K&0\\0&0&K&0&0\end{bmatrix}
\end{equation*}

\begin{hebrew}
ב. נמצא את $\alpha$ שישמור על הממוצע של התמונה המקורית. לטובת זאת, נשווה את הממוצע של הפילטר ל-1:
\end{hebrew}

\begin{equation*}
mean = \frac{1}{8} \cdot (12\cdot K + 8\cdot\alpha - 12K) = 1  \Longrightarrow  \alpha = \frac{8}{8} = 1
\end{equation*}

\begin{hebrew}
ג. כעת נתון ש-$\alpha$ הינו 1. כמו כן, מצאנו שגרעין $\psi$ הינו $5X5$, כלומר $M=N=5$ נמצא את K אשר ימזער את השגיאה הריבועית המוגדרת:
\end{hebrew}
\begin{equation*}
E = \sum_{m=1}^M \sum_{m=1}^M |\psi -\delta|^2
\end{equation*}
\begin{equation*}
\psi -\delta  = \frac{1}{8} \cdot \begin{bmatrix}0&0&K&0&0\\0&2K&1&2K&0\\K&1&-4-12K&1&K\\0&2K&1&2K&0\\0&0&K&0&0\end{bmatrix}
\end{equation*}
\begin{align*}
E =& |\psi -\delta|^2 =  \frac{1}{8} \cdot ( 4\cdot K^2 + 4\cdot (2K)^2 + 4 + (-4-12K)^2 ) = \\
=& \frac{1}{8} \cdot ( 164K^2 + 96K + 20 )
\end{align*}
\begin{hebrew}
נמצא את המינימום, נגזור, נשווה ל-0
\end{hebrew}
\begin{align*}
\frac{\partial E}{\partial K} = \frac{\partial{|\psi -\delta|^2}}{\partial K} =  328K + 96 = 0 \Longrightarrow K = -\frac{96}{328} = -0.292 \approx -0.3
\end{align*}



\newpage
\begin{hebrew}
\textit{\huge שאלה 3.}

א. נמצא את הסינון הלינארי. נתבונן רק בפילטר של השחזור, ונמצא פילטר בודד:
\end{hebrew}

\newcommand{\NAcs}{\underline{N_a^{cs}}}
\newcommand{\Nrcs}{\underline{N_1^{cs}}}
\newcommand{\Nics}{\underline{N_2^{cs}}}


\subsection{a}
The expressions for $H_a$ and $\underline{N_a^{cs}}$ are the following:

\begin{align*}
H_\alpha &= O \\
\NAcs &= \Nrcs + i\Nics
\end{align*}

Finding the mean vector:

\begin{align*}
\mu_{N_{\alpha}} = [\mu_{\Nrcs}  \mu_{\Nics} ] = [ 0 ; 0 ] 
\end{align*}

Since $\underline{N_a^{cs}}$ is column vector of a complex-valued random variables, the covariance matrix is the expectation of its product with its conjugate transpose:


\begin{align*}
\Gamma_{N_{\alpha}} &= Cov[\NAcs ,\NAcs] = E[(\NAcs - \mu_{\NAcs})(\NAcs - \mu_{\NAcs})^H] = E[(\NAcs)(\NAcs)^H] \\ 
&= E[(\Nrcs + i\Nics)(\Nrcs + i\Nics)^H]  =  E[(\Nrcs + i\Nics)(\Nrcs^{T} - i\Nics^{T})]   \\ 
&= E[(\Nrcs\Nrcs^{T}) +(\Nics\Nics^{T})]= 2\cdot\sigma^{2}I
\end{align*}


\begin{hebrew}

ב. נרשום את הביטויים הנדרשים:
\end{hebrew}

\newcommand{\NBcs}{\underline{N_b^{cs}}}
\newcommand{\YBcs}{\underline{Y_b^{cs}}}

\begin{align*}
H_\beta &= O \\
\NBcs &= O(\Nrcs + i\Nics)
\end{align*}


\newcommand{\fml}{\hat{f_{ML}}}
\newcommand{\fcs}{f^{cs}}
\newcommand{\meanvec}{H_{b}\fcs}
\newcommand{\Hb}{H_{b}}
\begin{hebrew}
ג. נרשום את הי=פילוג של $\YBcs$, ומשם נוכל לחשב את ה-$\fml$
\end{hebrew}
\begin{align*}
\YBcs &\sim N(H_{b}\fcs, 2\sigma^{2}I) \\
P(\YBcs) &= C_{2}exp\left[-\frac{1}{2}(x-\mu)^{H}2\Gamma^{-1}(x-\mu)\right]
\end{align*}
\begin{hebrew}
נכניס את הנתונים שלנו ונקבל:
\end{hebrew}
\begin{align*}
P(\YBcs|\fcs) &= C_{2}exp\left[-\frac{1}{2}\frac{(\YBcs-\meanvec)^{H}(\YBcs-\meanvec)}{2\sigma^{2}I}\right]
\end{align*}

\begin{hebrew}
נקבל את השיערוך ע"י מקסימיזציה של ההסתברות ע"י מציאת $\fcs$ מתאים:
\end{hebrew}
\begin{align*}
\fml =& argmax_{\fcs}\left(P(\YBcs|\fcs)\right) = \\
=& argmax_{\fcs}\left(C_{2}exp\left[-\frac{1}{2}\frac{(\YBcs-\meanvec)^{H}(\YBcs-\meanvec)}{2\sigma^{2}I}\right]\right) = \\
=& argmin_{\fcs}\left((\YBcs-\meanvec)^{H}(\YBcs-\meanvec)\right) 
\end{align*}

\begin{hebrew}
נגזור לקבלת מינימום:
\end{hebrew}
\begin{align*}
\frac{\delta}{\delta\fcs}\left((\YBcs-\meanvec)^{H}(\YBcs-\meanvec)\right)  &= 0 \\ 
-\Hb^{H}(\YBcs-\meanvec)-\Hb^{T}(\YBcs-\meanvec)^{*} &= 0 \\ 
-\Hb^{H}\YBcs+\Hb^{H}\Hb\fcs-\Hb^{T}\YBcs^{*}+\Hb^{T}\Hb^{*}\fcs &= 0 \\
\left(\Hb^{H}\Hb+\Hb^{T}\Hb^{*}\right)\fcs &= \left(\Hb^{H}\YBcs+\Hb^{T}\YBcs^{*}\right) \\
\left(\Hb^{H}\Hb+\Hb^{T}\Hb^{*}\right)^{-1}\left(\Hb^{H}\YBcs+\Hb^{T}\YBcs^{*}\right) &= \fcs
\end{align*}
\begin{hebrew}
נזכר בתכונות של מטריצת $DFT$: היא אוניטרית וסימטרית. לכן:
\end{hebrew}
\begin{align*}
H_{b}^{*}H_{b} = H_{b}H_{b}^{*}  &= 1 \\
H_{b}^{T} &= H_{b}
\end{align*}

\begin{align*}
(I+I)^{-1}\left(\Hb^{H}\YBcs+\Hb^{T}\YBcs^{*}\right) &= \fcs \\
(I+I)^{-1}\left(\Hb^{-1}\YBcs+(\Hb^{-1}\YBcs)^{*}\right) &= \fcs
\end{align*}
\begin{hebrew}
שזוהי בעצם התמרה הפוכה:
\end{hebrew}
\begin{align*}
\fcs &= \frac{1}{2}\left(y_{b}^{cs} + (y_{b}^{cs})^{*}\right) \\ 
\fcs &= \frac{1}{2}\left(2\cdot real(y_{b}^{cs})\right)= real(y_{b}^{cs}) = y_{b}^{cs}
\end{align*}

\begin{hebrew}
קיבלנו שמערך המיטבי הינו התמרה הפוכה של פונקציית $\YBcs$, שזה נראה הגיוני, הרי שהשגיאה הינה סביב 0, כי הרעש מפולג סביב 0. 
\end{hebrew}

\begin{hebrew}
ד. כידוע מסימטריה של התמרת פורייה, אם ההתמרה מתבצעת על הפונקציה שהיא סימטרית (זוגית), אז יהיו לה רק ערכים ממשיים. כלומר, $\YBcs$ אמור להכיל רק מספרים ממשיים. לכן לפני ביצוע של ההתמרה ההפוכה אנו נאפס את האיברים המדומים של $\YBcs$ , כי ידוע לנו שהם הגיעו מהרעש. המשערך נשאר זהה, ניתן לרשום אותו פורמלית:
\end{hebrew}
\begin{align*}
\fcs &= F^{-1}\left(Real(\YBcs)\right)
\end{align*}




% \text{we use the rule: } \frac{\delta}{\delta x}\left((Ax+b)^{H}C(Dx+e)\right) &= (Ax+b)^{H}CD + (Dx+e)^{T}C^{T}A \\ 



\newpage

\begin{hebrew}
\textit{\huge שאלה 4.}

א. נמצא אלמנט בנייה עבור כל אחת מהתמונות $a-d$:
\end{hebrew}

For each case, we put the element onto the original figure to indicate the proportion

\begin{enumerate}[label=(\alph*.)]

\item The operation is \textbf{erosion}, the structuring element is the following, where dot indicates the center
\newline
\newline
\includegraphics{imgs/q3_11.png}
\item The operation is \textbf{erosion}, the structuring element is the following, where C indicates the center
\newline
\newline
\includegraphics{imgs/q3_12.png}
\item First operation is \textbf{erosion} with the first element, which is rectangular, which is higher, than the connecting part of 'U' letter. Second operation is dilation, with the structuring element of a circle.
\newline
\newline
\includegraphics{imgs/q3_13.png}
\item The operation is \textbf{dilation}, the structuring element is the following, where the dot indicates the center.
\newline
\newline
\includegraphics{imgs/q3_14.png}


\end{enumerate}


\begin{hebrew}
ב. התשובות מופיעות בסוף המסמך על דפים סרוקים.
\end{hebrew}



\newpage

\begin{hebrew}
\textit{\huge שאלה 5.}

א. כעת המודל יראה באופן הבא:
\end{hebrew}

\begin{equation*}
\begin{aligned}
&\underline{Y} = H\underline{X} + \underline{N} \\ 
&\underline{X} , \underline{Y}, \underline{N}  \in [M^2 ; 1] \\
&H \in [M^2 ; M^2]
\end{aligned}
\end{equation*}

\begin{hebrew}
מטריצה $H$ במקורה הייתה צריכה להכיל $1$ בכל איברי האלכסון שלה (מטריצה אלכסונית), ו-$0$ בכל השאר האתאים. אך כוון שחלק מהפיקסלים התאפסו, במקומות האלה יהיו  גם כן$0$. נניח, שפיקסל השני התאפס:
\end{hebrew}
\newline
\begin{equation*}
\begin{bmatrix}
1 & 0 & \cdots & 0\\
0 & 0 & \cdots & 0\\
\vdots & \vdots & \ddots & \vdots \\
0 & 0 & 0 & 1
\end{bmatrix}
\end{equation*}
\newline


\begin{hebrew}
מטריצה $N$ תכיל את הרעש. במקור זהו רעש גאוסי $W \sim N(0,\sigma_n^2)$, אך כעת במקומות בהן הפיקסל התאפס יהיה שם 0. השורות בהן הפיקסל התאפס מתאימות לשורות של $H$ בהן השורה התאפסה. לגבי הפילוג:
\begin{itemize}
\item הממוצע של הפילוג לא ישתנה, כוון שהוא שווה ל-$0$. החלפת חלק מהמספרים ב-$0$ לא ישפיע על הממוצע.
\item השונות של המטריצה תקטן. נזכר במשוואה עבור שונות:
\begin{equation*}
Var(N) = \frac{1}{M^2}\sum_{i=1}^{M^2}{(n_i - \mu)^2} = Var(N) = \frac{1}{M^2}\sum_{i=1}^{M^2}{n_i^2} 
\end{equation*}
כעת ידוע כי אחוז מסוים מהאיברים הינו $0$, אך כמות סה"כ של האיברים נשארה זהה. נעשה הנחה לגיטימית - השונות של האיברים שהתאפסו הינה זהה לשונות של כלל האיברים. נניח כי התאפסו $K\%$ מהפיקסלים. לכן, שונות החדשה הינה:

\begin{equation*}
\begin{aligned}
&\sigma_n^2 (new) = \sigma_n^2 -  \frac{1}{M^2}\sum_{zeroed-elements}{(n_i)^2} =\\
&\sigma_n^2 -  \frac{1}{M^2}\frac{K\%\cdot M^2}{1}\frac{1}{K\%\cdot M^2}\sum_{zeroed-elements}{(n_i)^2} =\\
&\sigma_n^2 - \frac{M^2 \cdot K\%}{M^2}\sigma_n^2 = (1-K\%)\sigma^2_n
\end{aligned}
\end{equation*}
כמובן, שאם למשל $K$ הינו $5\%$,  אנחנו נשתמש בערך של $0.05$
\end{itemize}
\end{hebrew}


\newpage
\begin{hebrew}
ב. כעת ידוע:
\end{hebrew}



\begin{align*}
K &= 0.05 \\ 
M &= 100   \Longrightarrow  H \in [100,100]
\end{align*}

\begin{hebrew}

מהגדרתו של $det$, מכוון שכל האיברים שהם לא על האלכסון הם 0, וגם חלק מערכים שעל האלכסון הם 0, נקבל:
\end{hebrew}

\begin{equation*}
det(H) = 0
\end{equation*}

\begin{hebrew}

מגודל של המטריצה, ומידיעה ש-$5\%$ מתוכם הם 0, ושאר הם 1, נקבל:
\end{hebrew}
\begin{equation*}
tr(H) = 100 - 5 = 95
\end{equation*}

\begin{hebrew}
ג. המשערך נראה כמו משערך רגיל של ML, עם קווריאנס ידוע.  אך כיוון שמטריצה H אינה הפיכה, לא נוכל להשתמש במשערך הנ"ל. כדי לפתור את הבעיה, אנו נוסיף איבר נוסף שימנע מתרחיש הזה לקרות, ותבטיח את קיום של האינוורס של החלק הראשון של המטריצה, ונקבל:
\end{hebrew}

\begin{equation*}
\underline{\hat{X}}_{ML} = (H^{T}\Lambda^{-1}H + \epsilon I)^{-1}H^{T}\Lambda^{-1}\hat{Y}
\end{equation*}
\begin{hebrew}
נקבל שיערוך פחות טוב, אך ישים.
\end{hebrew}




\includepdf[pages=-]{q4_2.pdf}

\end{document}





